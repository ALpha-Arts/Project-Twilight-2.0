# Root = Character

# Pulse #

on_monthly_pulse_character = {
	random_events = {
		1 = 0
		1 = twilight_rest_in_peace.100
	}
}

on_yearly_pulse_character = {
	random_events = {
		20 = character_events.1
	}
}

on_half_yearly_pulse_character = {}

on_five_year_pulse_character = {}

on_decade_pulse_character = {}

# Non-pulse #

on_character_creation = {}

on_character_death = {
	on_actions = {
		on_major_character_death
	}

	effect = {
		# Marriage
		if = {
			limit = {
				trigger_character_is_married = yes
			}
			effect_character_remove_marriage = yes
		}
	}
}

on_new_ruler = {
	effect = {
		# Alicornarchy
		if = {
			limit = { has_trait = alicorn_immortal }
			owner = { set_variable = alicornarchy }
		}
		else = {
			owner = { remove_variable = alicornarchy }
		}
	}
}

on_heir_born = {
	effect = {
		post_notification = heir_born_notification

		effect_set_culture_trait = yes
	}
}

on_enemy_convoys_raided = {
	effect = { post_notification = enemy_convoys_raided }
}

on_our_convoys_raided = {
	effect = { post_notification = our_convoys_raided }
}

on_character_recruitment = {
	effect = {
		owner = {
			if = {
				limit = { has_journal_entry = je_tutorial_recruit_promote_commander }
				je:je_tutorial_recruit_promote_commander = {
					set_variable = {
						name = tut_commander_target
						value = root
					}
					set_variable = {
						name = tut_commander_target_initial_rank
						value = root.commander_rank
					}
				}
			}
		}
	}
}

# Specific #

on_major_character_death = {
	effect = {
		if = {
			limit = {
				has_variable = is_twilight
				owner = {
					NOT = {
						has_variable = twilight_is_dead
					}
				}
			}
			if = {
				limit = {
					is_ruler = yes
					owner = {
						has_law = law_type:law_monarchy
					}
				}
				debug_log = "The Princess is dead. Long Live Equestria."
				trigger_event = {
					# id = twilight_rest_in_peace.?  # TODO
					id = twilight_rest_in_peace.1
				}
			}
			else = {
				trigger_event = {
					id = twilight_rest_in_peace.1
				}
			}
		}
		else_if = {
			limit = {
				has_variable = is_applejack
				owner = {
					NOT = {
						has_variable = applejack_is_dead
					}
				}
			}
			trigger_event = {
				id = twilight_rest_in_peace.2
			}
		}
		else_if = {
			limit = {
				has_variable = is_fluttershy
				owner = {
					NOT = {
						has_variable = fluttershy_is_dead
					}
				}
			}
			trigger_event = {
				id = twilight_rest_in_peace.3
			}
		}
		else_if = {
			limit = {
				has_variable = is_pinkie
				owner = {
					NOT = {
						has_variable = pinkie_is_dead
					}
				}
			}
			trigger_event = {
				id = twilight_rest_in_peace.4
			}
		}
		else_if = {
			limit = {
				has_variable = is_rainbow
				owner = {
					NOT = {
						has_variable = rainbow_is_dead
					}
				}
			}
			trigger_event = {
				id = twilight_rest_in_peace.5
			}
		}
		else_if = {
			limit = {
				has_variable = is_rarity
				owner = {
					NOT = {
						has_variable = rarity_is_dead
					}
				}
			}
			trigger_event = {
				id = twilight_rest_in_peace.6
			}
		}
		else_if = {
			limit = {
				has_variable = is_starlight
				owner = {
					NOT = {
						has_variable = starlight_is_dead
					}
				}
			}
			trigger_event = {
				id = twilight_rest_in_peace.7
			}
		}
	}
}
